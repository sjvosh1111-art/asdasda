<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>달러 환율 (Investing 크롤링) - 데모</title>
  <style>
    :root{--bg:#f6f7f8;--card:#fff;--muted:#6b6b6b;--accent:#2b9348}
    *{box-sizing:border-box;font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, Arial}
    body{margin:0;background:var(--bg);color:#111}
    header{background:#fff;border-bottom:1px solid #e6e6e6;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{font-weight:700;font-size:18px}
    .search{opacity:.9;color:var(--muted);font-size:13px}
    main{max-width:1100px;margin:28px auto;padding:0 20px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(20,20,20,0.03)}
    .pair{font-size:18px;font-weight:600}
    .rate{font-size:36px;font-weight:700}
    .change{font-size:14px;margin-left:10px}
    .meta{color:var(--muted);font-size:13px;margin-top:8px}
    .small{font-size:13px;color:var(--muted)}
    .news-list{display:flex;flex-direction:column;gap:12px;margin-top:10px}
    .news-item{display:flex;gap:12px;align-items:flex-start}
    .news-thumb{width:120px;height:72px;flex:0 0 120px;border-radius:6px;object-fit:cover;background:#efefef}
    @media (max-width:880px){.grid{grid-template-columns:1fr} .news-thumb{width:100px;height:64px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">N-EX · Investing 크롤링 데모</div>
      <div class="search">kr.investing.com 페이지(서버 크롤링)를 통해 USD→KRW 실시간 환율 표시</div>
    </div>
    <div class="meta" id="header-time">로딩중...</div>
  </header>

  <main>
    <div class="grid">
      <section>
        <div class="card" id="rate-card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="pair">미국 달러 (USD) → 원 (KRW)</div>
              <div class="meta" id="rate-updated">업데이트: --</div>
            </div>
            <div style="text-align:right">
              <div class="rate" id="rate">--</div>
              <div style="display:flex;justify-content:flex-end;align-items:center">
                <div class="change" id="rate-change">--</div>
              </div>
            </div>
          </div>

          <div style="margin-top:16px" class="small">
            환율 출처: <strong id="source">Investing.com (서버 크롤링)</strong> · 자동 갱신 간격:
            <span id="interval">20초</span>
          </div>

          <hr style="margin:16px 0;border:none;border-top:1px solid #f0f0f0" />

          <div>
            <div style="font-weight:600;margin-bottom:8px">관련 뉴스</div>
            <div id="news" class="news-list"></div>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <div style="font-weight:600;margin-bottom:8px">설명</div>
          <div class="small">브라우저에서 kr.investing.com을 직접 호출하면 CORS/스크립트로 안정적 값 획득이 어렵습니다. 서버 프록시를 두고 크롤링한 값을 제공받는 방식을 사용합니다.</div>
        </div>
      </section>

      <aside>
        <div class="card">
          <div style="font-weight:600;margin-bottom:12px">실시간 위젯</div>
          <div class="small">현재 시각 (한국): <div id="clock" style="font-weight:700;margin-top:6px"></div></div>
          <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />
          <div style="font-weight:600;margin-bottom:8px">빠른링크</div>
          <ul class="small" style="padding-left:18px;margin:0">
            <li><a href="https://kr.investing.com/currencies/usd-krw" target="_blank">Investing.com — USD/KRW (원본)</a></li>
          </ul>
        </div>

        <div class="card" style="margin-top:16px">
          <div style="font-weight:600;margin-bottom:8px">설정</div>
          <div class="small">갱신 간격(초): <input id="intervalInput" type="number" min="5" value="20" style="width:80px" /></div>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    
  </footer>

  <script>
    const rateEl = document.getElementById('rate');
    const changeEl = document.getElementById('rate-change');
    const updatedEl = document.getElementById('rate-updated');
    const sourceEl = document.getElementById('source');
    const headerTime = document.getElementById('header-time');
    const clock = document.getElementById('clock');
    const newsEl = document.getElementById('news');

    function fmt(d){const p=(n)=>String(n).padStart(2,'0');return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;}
    function updateClock(){const now=new Date(); headerTime.textContent='한국 시각: '+fmt(now); clock.textContent=fmt(now);}
    updateClock(); setInterval(updateClock,1000);

    async function fetchRate(){
      try{
        const r = await fetch('/api/investing-usd-krw');
        if(!r.ok) throw new Error('Network response not ok');
        const j = await r.json();
        if(j.rate){
          rateEl.textContent = Number(j.rate).toLocaleString('ko-KR', {maximumFractionDigits:2});
          changeEl.textContent = j.change || '';
          updatedEl.textContent = '업데이트: ' + (j.fetchedAt ? new Date(j.fetchedAt).toLocaleString() : new Date().toLocaleString());
          sourceEl.textContent = 'Investing.com (서버 크롤링)';
        } else {
          rateEl.textContent='--'; changeEl.textContent='--'; updatedEl.textContent='업데이트: --';
        }
      }catch(e){
        console.error(e);
        rateEl.textContent='--'; changeEl.textContent='--'; updatedEl.textContent='업데이트: 오류';
      }
    }

    // 데모 뉴스
    const demoNews = [
      {title:'달러/원 주요 이슈 요약', source:'연합뉴스', img:'https://via.placeholder.com/240x144?text=News+1', url:'#'},
      {title:'외환시장 변동성 대응 전략', source:'매일경제', img:'https://via.placeholder.com/240x144?text=News+2', url:'#'}
    ];
    function renderNews(list){ newsEl.innerHTML=''; list.forEach(n=>{ const item=document.createElement('div'); item.className='news-item'; item.innerHTML = `
      <img class="news-thumb" src="${n.img}" alt="thumb" onerror="this.src='https://via.placeholder.com/240x144?text=No+Image'" />
      <div class="news-body"><a class="news-title" href="${n.url}" target="_blank">${n.title}</a><div class="news-source">${n.source}</div></div>`; newsEl.appendChild(item); }); }
    renderNews(demoNews);

    fetchRate();
    let timer=null;
    function startInterval(){ const s = Number(document.getElementById('intervalInput').value)||20; document.getElementById('interval').textContent = s + '초'; if(timer) clearInterval(timer); timer = setInterval(fetchRate, s*1000); }
    document.getElementById('intervalInput').addEventListener('change', startInterval);
    startInterval();
  </script>
</body>
</html>
